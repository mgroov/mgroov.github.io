<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users</title>
    <link rel="stylesheet" href="../../app.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav>
        <div class="heading">
            <h4>Rocks</h4>
        </div>
        <!--  checkbox to control the icon's state    -->
        <input id="menu-toggle" type="checkbox" />
        <label class="menu-button-container" for="menu-toggle">
            <div class="menu-button"></div>
        </label>
        <ul class="menu">
            <li><a href="../index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="blog.html">Blog</a></li>
            <li><a href="careers.html">Careers</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="pricing.html">Services</a></li>
            <li><a href="payment.html">Payment</a></li>
            <li><a class="active" href="unique-users.html">Users</a></li>
        </ul>
    </nav>

    <!-- Use our hosted Lambda function to grab unique users (Hardcoded string for now) -->
    <!-- Followed tutorial at https://www.youtube.com/watch?v=UeVIRnWW76c -->
    <div class="card-grid">
        <div class="body-text"><h1>Unique Website Visitors</h1></div>
        <div class="card">
            <div class="card-text" id="unique"></div>
        </div>
    </div>

    <!-- Importing jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    
    <!-- AJAX call to get the unique users count and display it -->
    <script>
        $.ajax({
            url: "https://aq1kk2fsu8.execute-api.us-east-2.amazonaws.com/default/test-lambda",
            dataType: "json",
            success:function(unique){
                populate(unique);
            }
        });
        function populate(unique) {
            document.getElementById('unique').innerHTML = unique;
        }
    </script>

    <!-- Script to record unique visitors -->
    <script>
        // Check if the current visitor is recorded in the local storage.
        if (!localStorage.getItem('recordedVisit')) {
            const visitorID = navigator.userAgent + Math.random(); // Simple method for generating a unique visitor ID. 
    

            $.ajax({
                url: "https://aq1kk2fsu8.execute-api.us-east-2.amazonaws.com/default/test-lambda",
                method: "POST",
                dataType: "json",
                success:function(response){
                    localStorage.setItem('recordedVisit', 'true');
                }
            });
            // Send this visitor ID to your Lambda function to record it
            // $.ajax({
            //     url: "https://aq1kk2fsu8.execute-api.us-east-2.amazonaws.com/default/test-lambda", // Replace with your Lambda endpoint.
            //     method: "POST",
            //     data: JSON.stringify({ visitorID: visitorID }),
            //     contentType: "application/json",
            //     success: function(response) {
            //         // If successfully recorded, mark this visitor as recorded in local storage.
            //         localStorage.setItem('recordedVisit', 'true');
            //     },
            //     error: function(err) {
            //         console.error("Failed to record the visitor:", err);
            //     }
            // });
        }
    </script>
</body>
</html>